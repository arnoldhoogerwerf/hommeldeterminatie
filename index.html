<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zoekkaart hommels</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: system-ui, sans-serif;
      background: #f9f9f9;
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 480px;
      width: 100%;
      margin: 0 auto;
      background: #fff;
      min-height: 100vh;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      padding: 0;
    }
    .question {
      text-align: center;
      font-size: 2.2rem;
      margin: 1em 2em 0.5em 2em;
      min-height: 3.5em;
      max-width: 360px;
    }
    .result {
      text-align: center;
      font-size: 2.2em;
      font-weight: bold;
      margin: 1.5em 1em 0.5em 1em;
      min-height: 3.5em;
    }
    .image-container {
      width: 75vw;
      max-width: 360px;
      aspect-ratio: 1 / 1;
      margin: 2.5em auto 2em auto;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f3f3f3;
      border-radius: 12px;
      overflow: hidden;
    }
    .image-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
      display: block;
      background: none;
      box-shadow: none;
      border: none;
    }
    .answer-buttons, .nav-buttons {
      display: flex;
      gap: 0.7em;
      justify-content: center;
      margin: 0;
    }
    .button-bar {
      width: 100%;
      box-sizing: border-box;
    }
    .answer-buttons button, .nav-buttons button {
      flex: 1 1 0;
      font-size: 1.2em;
      padding: 1em 0;
      border: none;
      border-radius: 8px;
      color: #fff;
      font-weight: bold;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      transition: background 0.2s;
      margin: 0;
      outline: none;
    }
    .answer-buttons .yes { background: #2ecc40; }
    .answer-buttons .no { background: #ff4136; }
    .nav-buttons .secondary {
      background: #aaa;
      color: #fff;
      font-weight: normal;
    }
    .rare-result {
      color: #d00;
    }
    @media (max-width: 600px) {
      .container {
        max-width: 100vw;
        width: 100vw;
        min-height: 100vh;
        box-shadow: none;
        padding: 0;
      }
      .question {
        font-size: 1.6em;
        margin: 1em 1.5em 0.5em 1.5em;
        max-width: 360px;
        text-align: center;
      }
      .result {
        font-size: 2em;
      }
      .image-container {
        width: 75vw;
        max-width: 75vw;
        aspect-ratio: 1 / 1;
        margin: 2.5em auto 2em auto;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f3f3f3;
        border-radius: 12px;
        overflow: hidden;
      }
      .image-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 12px;
        display: block;
        background: none;
        box-shadow: none;
        border: none;
      }
      .answer-buttons, .nav-buttons {
        margin: 1em 0.5em 0 0.5em;
      }
    }
  </style>
</head>
<body>
  <div class="titlebar" id="titlebar" style="position:fixed;top:0;left:0;right:0;z-index:30;height:48px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.10);display:flex;align-items:center;justify-content:center;padding:0;max-width:480px;margin:0 auto;cursor:pointer;">
    <button id="homeBtn" style="position:absolute;left:0;top:0;bottom:0;background:none;border:none;padding:0 1em 0 0.7em;cursor:pointer;font-size:1.5em;line-height:1;display:flex;align-items:center;justify-content:center;flex:0 0 auto;z-index:2;height:48px;align-self:stretch;">
      <img src="EIS-Logo_rond3_Tekengebied-1.png.webp" alt="EIS Kenniscentrum Insecten" style="display:flex;align-items:center;height:32px;max-height:32px;width:auto;" />
      <img src="Naturalis Biodiversity Center.svg" alt="EIS Kenniscentrum Insecten" style="display:flex;align-items:center;height:25px;max-height:25px;width:auto;" />
    </button>
    <div id="titlebarCenter" style="position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;pointer-events:none;">
      <span style="font-size:1.15em;font-weight:bold;letter-spacing:0.01em;line-height:1;">Zoekkaart hommels</span>
    </div>
    <div id="titlebarClickArea" style="position:absolute;left:0;right:0;top:0;bottom:0;z-index:1;"></div>
  </div>
  <div id="splash" style="position:relative;z-index:10;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;background:#fff;padding-top:0.5em;padding-bottom:2em;min-height:100vh;padding-left:1.2em;padding-right:1.2em;">
    <div style="width:100%;max-width:440px;text-align:center;margin-bottom:1.2em;">
      <img src="EIS-Logo_rond3_Tekengebied-1.png.webp" alt="EIS Kenniscentrum Insecten" style="width:120px;height:120px;margin:0 auto 0.1em auto;display:inline-block;" />
      <img src="Naturalis Biodiversity Center.svg" alt="Naturalis Biodiversity Center" style="width:110px;height:110px;margin:0 auto 0.1em auto;display:inline-flex;" />
      <div style="font-size:2em;font-weight:700;margin-bottom:0.15em;">Zoekkaart hommels</div>
      <div style="font-size:1em;font-weight:500;color:#444;">Interactieve zoekkaart voor gebruik in het veld</div>
    </div>
    <button id="startBtn" style="font-size:1.2em;padding:0.8em 2em;border:none;border-radius:8px;background:#2ecc40;color:#fff;font-weight:bold;margin-bottom:2em;">Start</button>
    <img src="bouw-hommel.png" alt="Bouw van een hommel" style="max-width:340px;width:100%;display:block;margin:0 auto 1.2em auto;" />
    <div style="max-width:420px;text-align:left;font-size:0.85em;line-height:1.5;margin-bottom:1.5em;">
      Het lichaam van een hommel bestaat uit drie delen: een kop, een borststuk en een achterlijf. Het borststuk draagt drie paar poten en twee paar vleugels. Mannetjes en vrouwtjes onderscheiden zich door het aantal antenneleden en het aantal achterlijfssegmenten, 12 antenneleden en 6 achterlijfssegmenten bij vrouwtjes en 13 en 7 bij mannetjes. Tevens is de vorm van het achterlijf vaak wat breder en meer afgerond bij vrouwtjes.
    </div>
    <div id="splash-footer" style="background:#fff;padding:0.8em 1.2em 1.2em 1.2em;font-size:0.75em;color:#888;max-width:420px;margin:0 auto 0 auto;text-align:center;">
      Proof of concept gemaakt door <a href="https://arnoldhoogerwerf.net" target="_blank" style="color:#0074d9;text-decoration:underline;">Arnold Hoogerwerf</a> op basis van de determinatiesleutel en illustraties uit de <a href="https://kenniscentruminsecten.nl/publicaties/basisgids-hommels/" target="_blank" style="color:#0074d9;text-decoration:underline;">Basisgids Hommels</a> en de <a href="https://kenniscentruminsecten.nl/wp-content/uploads/2024/11/Zoekkaart_hommels.pdf" target="_blank" style="color:#0074d9;text-decoration:underline;">Zoekkaart Hommels</a> van <a href="https://kenniscentruminsecten.nl/" target="_blank" style="color:#0074d9;text-decoration:underline;">EIS Kenniscentrum Insecten en andere ongewervelden</a> / <a href="https://www.naturalis.nl" target="_blank" style="color:#0074d9;text-decoration:underline;">Naturalis Biodiversity Center</a>
    </div>
  </div>
  <div class="container" id="main-app" style="display:none; position:relative;">
    <div class="main-content" style="flex:1 1 auto; overflow-y:auto; padding-top:48px; padding-bottom:6.5em;">
      <div class="image-container">
        <img id="image" src="" alt="Vraag afbeelding" />
      </div>
      <div id="info-block"></div>
      <div class="question" id="question"></div>
    </div>
    <div class="button-bar" style="position:fixed;left:0;right:0;bottom:0;z-index:20;max-width:480px;margin:0 auto;padding:0.7em 1em 0.7em 1em;background:#fff;box-shadow:0 -2px 12px rgba(0,0,0,0.13);display:flex;flex-direction:column;gap:0.5em;">
      <div class="answer-buttons" id="answer-buttons" style="margin:0;"></div>
      <div class="nav-buttons" id="nav-buttons" style="margin:0;"></div>
    </div>
  </div>
  <script>
    // Verberg de titelbalk als het splash screen zichtbaar is
    function updateTitlebarVisibility() {
      const splash = document.getElementById('splash');
      const titlebar = document.getElementById('titlebar');
      if (splash.style.display === 'flex') {
        titlebar.style.display = 'none';
      } else {
        titlebar.style.display = '';
      }
    }
    // Zorg dat de titelbalk direct goed wordt weergegeven bij laden
    updateTitlebarVisibility();
    // Titelbalk klikbaar (behalve homebutton)
    document.getElementById('titlebarClickArea').onclick = function(e) {
      // Klik op homeBtn negeren
      const homeBtn = document.getElementById('homeBtn');
      if (e.target === homeBtn || homeBtn.contains(e.target)) return;
      document.getElementById('splash').style.display = 'flex';
      document.getElementById('main-app').style.display = 'none';
      updateTitlebarVisibility();
    };
    // Home button functionaliteit
    document.getElementById('homeBtn').onclick = function(e) {
      e.stopPropagation();
      document.getElementById('splash').style.display = 'flex';
      document.getElementById('main-app').style.display = 'none';
      updateTitlebarVisibility();
    };
    // De volledige flowchart-structuur
    const tree = {
      q: "Bovenkant borststuk egaal oranje/bruin behaard?",
      img: "borststuk-oranje-bruin-vraag.jpg",
      yes: {
        q: "Achterlijf wit?",
        img: "achterlijf-wit-vraag.jpg",
        yes: {
          result: "Boomhommel",
          img: "boomhommel-resultaat.jpg",
          active: "Maart – augustus (koningin vanaf februari, werksters vanaf april, mannetjes vanaf mei)",
          description: "De boomhommel is een vrij grote hommelsoort die veel voorkomt in tuinen, parken en bosranden. Het borststuk is oranje-bruin behaard, het achterlijf is zwart met een witte punt. Boomhommels nestelen vaak in nestkastjes of holle bomen. Ze zijn goed te herkennen aan hun kleurpatroon en hun voorkeur voor nestplaatsen boven de grond.",
          infoUrl: "https://nl.wikipedia.org/wiki/Boomhommel",
          activeMonths: {
            queen:  [false, true, true, true, true, true, false, false, false, false, false, false], // feb-aug
            worker: [false, false, false, true, true, true, true, true, false, false, false, false], // apr-aug
            male:   [false, false, false, false, true, true, true, true, false, false, false, false] // mei-aug
          }
        },
        no: {
          q: "Achterlijf of gehele achterlijf oranjerood, met duidelijke zwarte haren?",
          img: "achterlijf-oranjerood-vraag.jpg",
          yes: { result: "Akkerhommel (donkere vorm)", img: "akkerhommel-donker-resultaat.jpg",
            active: "Maart – oktober (koningin vanaf maart, werksters vanaf april, mannetjes vanaf mei)",
            description: "De akkerhommel is een vrij kleine, oranje tot lichtbruine hommel die veel voorkomt in tuinen, graslanden en bermen. De soort is variabel van kleur, met een lichte en een donkere vorm. Ze nestelen vaak bovengronds in graspolen of onder mos.",
            infoUrl: "https://nl.wikipedia.org/wiki/Akkerhommel",
            activeMonths: {
              queen:  [false, false, true, true, true, true, true, true, true, true, false, false], // mrt-okt
              worker: [false, false, false, true, true, true, true, true, true, true, false, false], // apr-okt
              male:   [false, false, false, false, true, true, true, true, true, true, false, false] // mei-okt
            }
          },
          no: {
            q: "Borststuk met beharing van één lengte? (Van opzij ziet het borststuk er als geschoren uit)",
            img: "borststuk-gelijke-lengte-vraag.jpg",
            yes: { result: "Moshommel (zeldzaam!)", img: "moshommel-resultaat.jpg",
              active: "Mei – september (koningin vanaf mei, werksters vanaf juni, mannetjes vanaf juli)",
              description: "De moshommel is een zeldzame soort met een oranje tot zandkleurige beharing. Ze nestelen vaak in graslanden en duinen, meestal bovengronds onder mos. De soort is te herkennen aan de gelijkmatige beharing en het ontbreken van duidelijke banden.",
              infoUrl: "https://www.wildebijen.nl/mos_hommel.html",
              activeMonths: {
                queen:  [false, false, false, false, true, true, true, true, true, false, false, false], // mei-sep
                worker: [false, false, false, false, false, true, true, true, true, false, false, false], // jun-sep
                male:   [false, false, false, false, false, false, true, true, true, false, false, false] // jul-sep
              }
            },
            no: {
              q: "Achterlijf met bruine band aan de basis, tussen de oranje beharing?",
              img: "achterlijf-bruine-band-vraag.jpg",
              yes: { result: "Heidehommel (zeldzaam!)", img: "Heidehommel-resultaat.jpg",
                active: "Mei – september (koningin vanaf mei, werksters vanaf juni, mannetjes vanaf juli)",
                description: "De heidehommel is een zeldzame soort van schrale graslanden en heidevelden. Ze zijn lichtgeel tot zandkleurig behaard met een bruine band op het achterlijf. De soort is lastig te onderscheiden van andere lichte hommels.",
                infoUrl: "https://nl.wikipedia.org/wiki/Heidehommel",
                activeMonths: {
                  queen:  [false, false, false, false, true, true, true, true, true, false, false, false], // mei-sep
                  worker: [false, false, false, false, false, true, true, true, true, false, false, false  ], // jun-sep
                  male:   [false, false, false, false, false, false, true, true, true, false, false, false] // jul-sep
                }
              },
              no: { result: "Akkerhommel (lichte vorm)", img: "akkerhommel-licht-resultaat.jpg",
                active: "Maart – oktober (koningin vanaf maart, werksters vanaf april, mannetjes vanaf mei)",
                description: "De lichte vorm van de akkerhommel heeft een overwegend gele tot lichtbruine beharing. Komt veel voor in tuinen, graslanden en bermen. Nestelt vaak bovengronds in graspolen of onder mos.",
                infoUrl: "https://nl.wikipedia.org/wiki/Akkerhommel",
                activeMonths: {
                  queen:  [false, false, true, true, true, true, true, true, true, true, false, false], // mrt-okt
                  worker: [false, false, false, true, true, true, true, true, true, true, false, false], // apr-okt
                  male:   [false, false, false, false, true, true, true, true, true, true, false, false] // mei-okt
                }
              }
            }
          }
        }
      },
      no: {
        q: "Achterlijf met (oranje)rode punt?",
        img: "achterlijf-rode-punt-vraag.jpg",
        yes: {
          q: "Kop bovenop geel behaard & borststuk met minstens 1 gele band?",
          img: "kop-geel-behaard-vraag.jpg",
          yes: {
            q: "Achterlijf zwart met rode punt & achterlijf kort en gelijkmatig behaard?",
            img: "achterlijf-zwart-met-rode-punt-kort-behaard-vraag.jpg",
            yes: { result: "Steenhommel (man)", img: "steenhommel-man-resultaat.jpg",
              active: "April – augustus (koningin vanaf maart, werksters vanaf april, mannetjes vanaf mei)",
              description: "De steenhommel is een grote, geheel zwarte hommel met een oranjerode achterlijfspunt. De mannetjes zijn te herkennen aan hun lichtere beharing op het gezicht. Ze nestelen vaak onder de grond, in oude muizenholen of composthopen.",
              infoUrl: "https://nl.wikipedia.org/wiki/Steenhommel",
              activeMonths: {
                queen:  [false, false, true, true, true, true, true, false, false, false, false, false], // mrt-aug
                worker: [false, false, false, true, true, true, true, true, false, false, false, false], // apr-aug
                male:   [false, false, false, false, true, true, true, true, false, false, false, false] // mei-aug
              }
            },
            no: { result: "Weidehommel (man)", img: "weidehommel-man-resultaat.jpg",
              active: "Maart – augustus (koningin vanaf maart, werksters vanaf april, mannetjes vanaf mei)",
              description: "De weidehommel is een kleine hommel met een gele band op het borststuk en een oranje achterlijfspunt. De mannetjes zijn te herkennen aan hun lichtere kleur. Ze nestelen bovengronds in graslanden en tuinen.",
              infoUrl: "https://nl.wikipedia.org/wiki/Weidehommel",
              activeMonths: {
                queen:  [false, false, true, true, true, true, true, false, false, false, false, false], // mrt-aug
                worker: [false, false, false, true, true, true, true, true, false, false, false, false], // apr-aug
                male:   [false, false, false, false, true, true, true, true, false, false, false, false] // mei-aug
              }
            }
          },
          no: {
            q: "Kop zwart behaard & borststuk zwart, met gele band of met grijsbruine haren tussen de zwarte beharing",
            img: "kop-zwart-behaard-borststuk-zwart-vraag.jpg",
            yes: {
              q: "Vleugel opvallend donker?",
              img: "vleugel-verdonkerd-vraag.jpg",
              yes: { result: "Rode koekoekshommel (vrouw) (zeldzaam!)", img: "rode-koekoekshommel-vrouw-resultaat.jpg",
                active: "April – augustus (vooral mei – juli)",
                description: "De rode koekoekshommel is een parasitaire soort die haar eieren legt in nesten van andere hommels, vooral de steenhommel. De vrouwtjes zijn geheel zwart met een rode achterlijfspunt en hebben verdonkerde vleugels.",
                infoUrl: "https://nl.wikipedia.org/wiki/Rode_koekoekshommel",
                activeMonths: {
                  queen:  [false, false, false, true, true, true, true, true, false, false, false, false], // apr-aug
                  worker: [false, false, false, false, false, false, false, false, false, false, false, false],
                  male:   [false, false, false, false, true, true, true, true, false, false, false, false] // mei-aug
                }
              },
              no: {
                q: "Borststuk en achterlijf geheel zwart behaard?",
                img: "borststuk-achterlijf-zwart-behaard-vraag.jpg",
                yes: {
                  q: "Achterschenen met korfjesharen?",
                  img: "achterschenen-korfjesharen-vraag.jpg",
                  yes: { result: "Steenhommel (vrouw)", img: "steenhommel-vrouw-resultaat.jpg",
                    active: "Maart – augustus (koningin vanaf maart, werksters vanaf april, mannetjes vanaf mei)",
                    description: "De vrouwtjes van de steenhommel zijn groot, geheel zwart met een oranjerode achterlijfspunt. Ze nestelen vaak ondergronds in oude muizenholen of composthopen.",
                    infoUrl: "https://nl.wikipedia.org/wiki/Steenhommel",
                    activeMonths: {
                      queen:  [false, false, true, true, true, true, true, false, false, false, false, false], // mrt-aug
                      worker: [false, false, false, true, true, true, true, true, false, false, false, false], // apr-aug
                      male:   [false, false, false, false, true, true, true, true, false, false, false, false] // mei-aug
                    }
                  },
                  no: {
                    q: "Achterscheen met oranjerode korfjesharen?",
                    img: "achterschenen-oranjerode-korfjesharen-vraag.jpg",
                    yes: { result: "Grashommel (zeldzaam!)", img: "grashommel-resultaat.jpg",
                      active: "April – augustus (koningin vanaf april, werksters vanaf mei, mannetjes vanaf juni)",
                      description: "De grashommel is een kleine, zeldzame hommel met een zwart lichaam en een oranjerode achterlijfspunt. Ze nestelen bovengronds in graslanden en zijn te herkennen aan de oranjerode haren op de achterschenen.",
                      infoUrl: "https://nl.wikipedia.org/wiki/Grashommel",
                      activeMonths: {
                        queen:  [false, false, false, false, true, true, true, true, true, false, false, false], // apr-aug
                        worker: [false, false, false, false, false, true, true, true, true, true, false, false], // mei-aug
                        male:   [false, false, false, false, false, false, true, true, true, true, false, false] // jun-aug
                      }
                    },
                    no: {}
                  }
                },
                no: {
                  q: "Borststuk en / of begin achterlijf met gele band of met grijsbruine haren tussen de zwarte beharing?",
                  img: "borststuk-begin-achterlijf-gele-band-grijsbruine-haren-vraag.jpg",
                  yes: {
                    q: "Voorkant borststuk & voorkant achterlijf met gele band?",
                    img: "voorkant-borstuk-voorkant-achterlijf-gele-band.jpg",
                    yes: { result: "Weidehommel (vrouw)", img: "weidehommel-vrouw-resultaat.jpg",
                      active: "Maart – augustus (koningin vanaf maart, werksters vanaf april, mannetjes vanaf mei)",
                      description: "De vrouwtjes van de weidehommel zijn klein, met een gele band op het borststuk en een oranje achterlijfspunt. Ze nestelen bovengronds in graslanden en tuinen.",
                      infoUrl: "https://nl.wikipedia.org/wiki/Weidehommel",
                      activeMonths: {
                        queen:  [false, false, true, true, true, true, true, false, false, false, false, false], // mrt-aug
                        worker: [false, false, false, true, true, true, true, true, false, false, false, false], // apr-aug
                        male:   [false, false, false, false, true, true, true, true, false, false, false, false] // mei-aug
                      }
                    }
                  },
                  no: {
                    q: "Borststuk vooraan en achteraan & basis achterlijf met grijs gele haren tussen de zwarte beharing?",
                    img: "borststuk-vooraan-achteraan-basis-achterlijf-grijs-gele-haren-vraag.jpg",
                    yes: { result: "Rode koekoekshommel (man) (zeldzaam!)", img: "rode-koekoekshommel-man-resultaat.jpg",
                      active: "Mei – augustus (vooral juni – juli)",
                      description: "De mannetjes van de rode koekoekshommel zijn zwart met een rode achterlijfspunt en verdonkerde vleugels. Ze zijn parasitair en leggen hun eieren in nesten van andere hommels.",
                      infoUrl: "https://nl.wikipedia.org/wiki/Rode_koekoekshommel",
                      activeMonths: {
                        queen:  [false, false, false, false, false, false, false, false, false, false, false, false],
                        worker: [false, false, false, false, false, false, false, false, false, false, false, false],
                        male:   [false, false, false, false, true, true, true, true, false, false, false, false] // mei-aug
                      }
                    },
                    no: {
                      q: "Kop kleiner en nooit vierkant?",
                      img: "kop-kleiner-nooit-vierkant-vraag.jpg",
                      yes: { result: "Grashommel (zeldzaam!)", img: "grashommel-resultaat.jpg",
                        active: "April – augustus (koningin vanaf april, werksters vanaf mei, mannetjes vanaf juni)",
                        description: "De grashommel is een kleine, zeldzame hommel met een zwart lichaam en een oranjerode achterlijfspunt. Ze nestelen bovengronds in graslanden en zijn te herkennen aan de oranjerode haren op de achterschenen.",
                        infoUrl: "https://nl.wikipedia.org/wiki/Grashommel",
                        activeMonths: {
                          queen:  [false, false, false, false, true, true, true, true, true, false, false, false], // apr-aug
                          worker: [false, false, false, false, false, true, true, true, true, true, false, false], // mei-aug
                          male:   [false, false, false, false, false, false, true, true, true, true, false, false] // jun-aug
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        no: {
          q: "Achterlijfspunt geel & rest van achterlijf òf geheel zwart, òf vrijwel geheel licht (bruin)geel?",
          img: "achterlijfspunt-geel-rest-achterlijf-zwart-of-bruingeel-vraag.jpg",
          yes: {
            q: "Zowel borststuk als achterlijf vrijwel geheel zandkleurig geelbruin behaard & tussen de vleugelinplanting met een band van zwarte haren",
            img: "borststuk-achterlijf-geheel-zandkleurig-vraag.jpg",
            yes: { result: "Zandhommel (zeldzaam!)", img: "zandhommel-resultaat.jpg",
              active: "Mei – augustus (koningin vanaf mei, werksters vanaf juni, mannetjes vanaf juli)",
              description: "De zandhommel is een zeldzame soort van schrale graslanden en duinen. Ze zijn lichtgeel tot zandkleurig behaard en nestelen meestal bovengronds onder gras of mos.",
              infoUrl: "https://nl.wikipedia.org/wiki/Zandhommel",
              activeMonths: {
                queen:  [false, false, false, false, true, true, true, true, true, false, false, false], // mei-aug
                worker: [false, false, false, false, false, true, true, true, true, true, false, false], // jun-aug
                male:   [false, false, false, false, false, false, true, true, true, true, false, false] // jul-aug
              }
            },
            no: { result: "Gewone koekoekshommel", img: "gewone-koekoekshommel-resultaat.jpg",
              active: "April – augustus (vooral mei – juli)",
              description: "De gewone koekoekshommel is een parasitaire soort die haar eieren legt in nesten van andere hommels, vooral de veldhommel en aardhommel. Ze is te herkennen aan de overwegend gele lichaamsbeharing en het ontbreken van stuifmeelkorfjes.",
              infoUrl: "https://nl.wikipedia.org/wiki/Gewone_koekoekshommel",
              activeMonths: {
                queen:  [false, false, false, true, true, true, true, true, false, false, false, false], // apr-aug
                worker: [false, false, false, false, false, false, false, false, false, false, false, false],
                male:   [false, false, false, false, true, true, true, true, false, false, false, false] // mei-aug
              }
            }
          },
          no: {
            q: "Achterlijfspunt wit & rest van achterlijf geheel zwart of zwart met een gele band?",
            img: "achterlijfspunt-wit-vraag.jpg",
            yes: {
              q: "Borststuk met een gele band vooraan en een gele band achteraan?",
              img: "borststuk-gele-band-vooraan-achteraan-vraag.jpg",
              yes: {
                q: "Kop zeer lang, dieren erg groot? Onder anderen veel in tuinen?",
                img: "kop-zeer-lang-erg-groot-vraag.jpg",
                yes: { result: "Tuinhommel", img: "tuinhommel-resultaat.jpg",
                  active: "Maart – september (koningin vanaf maart, werksters vanaf april, mannetjes vanaf mei)",
                  description: "De tuinhommel is een vrij grote hommel met een lang gezicht en een opvallend lange tong. Ze heeft een zwart lichaam met gele banden en een witte achterlijfspunt. Komt veel voor in tuinen en parken.",
                  infoUrl: "https://nl.wikipedia.org/wiki/Tuinhommel",
                  activeMonths: {
                    queen:  [false, false, true, true, true, true, true, true, true, false, false, false], // mrt-sep
                    worker: [false, false, false, true, true, true, true, true, true, true, false, false], // apr-sep
                    male:   [false, false, false, false, true, true, true, true, true, true, false, false] // mei-sep
                  }
                },
                no: { result: "Veenhommel", img: "veenhommel-resultaat.jpg",
                  active: "April – augustus (koningin vanaf april, werksters vanaf mei, mannetjes vanaf juni)",
                  description: "De veenhommel is een vrij kleine hommel met een korte kop en een lichte beharing. Ze komt vooral voor in veengebieden en natte heide.",
                  infoUrl: "https://nl.wikipedia.org/wiki/Veenhommel",
                  activeMonths: {
                    queen:  [false, false, false, true, true, true, true, true, false, false, false, false], // apr-aug
                    worker: [false, false, false, false, true, true, true, true, false, false, false, false], // mei-aug
                    male:   [false, false, false, false, false, true, true, true, false, false, false, false] // jun-aug
                  }
                }
              },
              no: {
                q: "Borststuk met slechts één gele band of geheel geel behaard & kop bovenop geel behaard",
                img: "borststuk-slechts-een-gele-band-vraag.jpg",
                yes: { result: "Veldhommel (man)", img: "veldhommel-resultaat.jpg",
                  active: "Maart – augustus (koningin vanaf maart, werksters vanaf april, mannetjes vanaf mei)",
                  description: "De veldhommel is een vrij kleine hommel met een zwart lichaam, citroengele banden en een witte achterlijfspunt. De mannetjes zijn te herkennen aan hun lichtere kleur. Ze nestelen ondergronds of bovengronds in graslanden.",
                  infoUrl: "https://nl.wikipedia.org/wiki/Veldhommel",
                  activeMonths: {
                    queen:  [false, false, true, true, true, true, true, false, false, false, false, false], // mrt-aug
                    worker: [false, false, false, true, true, true, true, true, false, false, false, false], // apr-aug
                    male:   [false, false, false, false, true, true, true, true, false, false, false, false] // mei-aug
                  }
                },
                no: {
                  q: "Kop bovenop zwart behaard & borststuk met slechts één gele band aan de voorkant?",
                  img: "kop-bovenop-zwart-borststuk-een-gele-band-voorkant-vraag.jpg",
                  yes: {
                    q: "Achterlijf met duidelijke en brede gele band op het tweede segment?",
                    img: "achterlijf-duidelijke-gele-band-tweede-segment-vraag.jpg",
                    yes: { result: "Aardhommelcomplex", img: "aardhommelcomplex-resultaat.jpg",
                      active: "Maart – oktober (koningin vanaf maart, werksters vanaf april, mannetjes vanaf mei)",
                      description: "Het aardhommelcomplex bestaat uit een groep lastig te onderscheiden soorten, waaronder de aardhommel, grote veldhommel en lichte koekoekshommel. Ze hebben een zwart lichaam met gele banden en een witte achterlijfspunt.",
                      infoUrl: "https://nl.wikipedia.org/wiki/Aardhommel",
                      activeMonths: {
                        queen:  [false, false, true, true, true, true, true, true, true, true, false, false], // mrt-okt
                        worker: [false, false, false, true, true, true, true, true, true, true, false, false], // apr-okt
                        male:   [false, false, false, false, true, true, true, true, true, true, false, false] // mei-okt
                      }
                    },
                    no: {
                      q: "Achterlijf zonder gele band & hooguit smal geel bandje op het eerste segment helemaal aan begin van achterlijf?",
                      img: "achterlijf-zonder-gele-band-hooguit-smal-geel-bandje-vraag.jpg",
                      yes: { result: "Tweekleurige / Grote koekoekshommel (zeldzaam!)", img: "tweekleurige-grote-koekoekshommel-resultaat.jpg",
                        active: "Mei – augustus (vooral juni – juli)",
                        description: "De tweekleurige en grote koekoekshommel zijn parasitaire soorten die hun eieren leggen in nesten van andere hommels. Ze zijn te herkennen aan hun contrasterende kleurpatronen en het ontbreken van stuifmeelkorfjes.",
                        infoUrl: "https://nl.wikipedia.org/wiki/Tweekleurige_koekoekshommel",
                        activeMonths: {
                          queen:  [false, false, false, false, false, false, false, false, false, false, false, false],
                          worker: [false, false, false, false, false, false, false, false, false, false, false, false],
                          male:   [false, false, false, false, true, true, true, true, false, false, false, false] // mei-aug
                        }
                      },
                      no: { result: "Boom- / Vierkleurige koekoekshommel", img: "boom-vierkleurige-koekoekshommel-resultaat.jpg",
                        active: "Mei – augustus (vooral juni – juli)",
                        description: "De vierkleurige koekoekshommel is een parasitaire soort die haar eieren legt in nesten van andere hommels. Ze is te herkennen aan haar bonte kleurpatroon en het ontbreken van stuifmeelkorfjes.",
                        infoUrl: "https://nl.wikipedia.org/wiki/Vierkleurige_koekoekshommel",
                        activeMonths: {
                          queen:  [false, false, false, false, false, false, false, false, false, false, false, false],
                          worker: [false, false, false, false, false, false, false, false, false, false, false, false],
                          male:   [false, false, false, false, true, true, true, true, false, false, false, false] // mei-aug
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    };

    // Navigatiegeschiedenis
    let history = [];
    let current = tree;

    // Splash start knop
    document.getElementById('startBtn').onclick = function() {
      document.getElementById('splash').style.display = 'none';
      document.getElementById('main-app').style.display = '';
      updateTitlebarVisibility();
      showNode(current);
    };

    // showNode zonder final screen
    function showNode(node) {
      const qEl = document.getElementById("question");
      const imgEl = document.getElementById("image");
      const answerBtns = document.getElementById("answer-buttons");
      const navBtns = document.getElementById("nav-buttons");
      const infoBlock = document.getElementById("info-block");
      answerBtns.innerHTML = "";
      navBtns.innerHTML = "";
      infoBlock.innerHTML = "";
      // Voeg vraagteken toe aan vragen indien nodig
      function ensureQuestionMark(text) {
        if (!text) return text;
        const trimmed = text.trim();
        // Geen vraagteken toevoegen aan resultaten (soortnamen)
        if (trimmed.endsWith("?")) return text;
        // Heuristiek: als het een vraag is (komt in een vraagveld), voeg ? toe
        // Resultaten worden getoond als node.result, vragen als node.q
        // Hier alleen toepassen op node.q
        return trimmed + "?";
      }

      // Lijst van zeldzame soorten
      const rareResults = [
        "Moshommel (zeldzaam!)",
        "Heidehommel (zeldzaam!)",
        "Rode koekoekshommel (vrouw) (zeldzaam!)",
        "Grashommel (zeldzaam!)",
        "Rode koekoekshommel (man) (zeldzaam!)",
        "Zandhommel (zeldzaam!)",
        "Tweekleurige / Grote koekoekshommel (zeldzaam!)"
      ];

      // Latijnse namen mapping
      const latinNames = {
        "Boomhommel": "Bombus hypnorum",
        "Akkerhommel (donkere vorm)": "Bombus pascuorum",
        "Moshommel (zeldzaam!)": "Bombus muscorum",
        "Heidehommel (zeldzaam!)": "Bombus humilis",
        "Akkerhommel (lichte vorm)": "Bombus pascuorum",
        "Steenhommel (man)": "Bombus lapidarius",
        "Weidehommel (man)": "Bombus pratorum",
        "Rode koekoekshommel (vrouw) (zeldzaam!)": "Bombus rupestris",
        "Steenhommel (vrouw)": "Bombus lapidarius",
        "Grashommel (zeldzaam!)": "Bombus ruderarius",
        "Weidehommel (vrouw)": "Bombus pratorum",
        "Rode koekoekshommel (man) (zeldzaam!)": "Bombus rupestris",
        "Zandhommel (zeldzaam!)": "Bombus veteranus",
        "Gewone koekoekshommel": "Bombus vestalis",
        "Tuinhommel": "Bombus hortorum",
        "Veenhommel": "Bombus jonellus",
        "Veldhommel (man)": "Bombus terrestris",
        "Aardhommelcomplex": "Bombus terrestris/lucorum",
        "Tweekleurige / Grote koekoekshommel (zeldzaam!)": "Bombus bohemicus",
        "Boom- / Vierkleurige koekoekshommel": "Bombus sylvestris"
      };

      if (node.result) {
        // Resultaatnaam, balkgrafiek en periode in een blokje (Boomhommel en andere soorten)
        let showInfoBlock = node.activeMonths && node.result;
        if (showInfoBlock) {
          let barGraph = "";
          if (node.activeMonths) {
            const months = ["J", "F", "M", "A", "M", "J", "J", "A", "S", "O", "N", "D"];
            // Detecteer of er geen werksters zijn (alle worker false)
            const hasWorkers = node.activeMonths.worker && node.activeMonths.worker.some(Boolean);
            if (!hasWorkers) {
              // Toon één enkele balk voor alle maanden waarin queen of male actief is
              let active = months.map((m, i) => (node.activeMonths.queen?.[i] || node.activeMonths.male?.[i]) ? true : false);
              let bars = active.map((isActive, i) => {
                let color = isActive ? '#2ecc40' : '#eee';
                let style = isActive ? '' : '';
                return `<div style='flex:1 1 0;min-width:0;min-height:10px;background:${color};${style}margin:0 1px;border-radius:2px;'></div>`;
              }).join("");
              let labels = months.map((m, i) => `<div style='flex:1 1 0;text-align:center;font-size:0.48em;color:#888;'>${m}</div>`).join("");
              barGraph = `<div style='max-width:95%;margin:0.5em auto 0.2em auto;'><div style='display:flex;gap:0.5px;'>${bars}</div><div style='display:flex;gap:0.5px;margin-top:2px;'>${labels}</div><div style='text-align:center;font-size:0.7em;color:#444;margin-top:0.2em;'>Actief</div></div>`;
            } else {
              let bars = months.map((m, i) => {
                const q = node.activeMonths.queen[i];
                const w = node.activeMonths.worker[i];
                const ma = node.activeMonths.male[i];
                let color = '#eee';
                let style = '';
                if (ma) {
                  color = '#2ecc40';
                  style = "background: repeating-linear-gradient(135deg, #228c1d, #228c1d 3px, #2ecc40 3px, #2ecc40 7px);";
                } else if (w) {
                  color = '#2ecc40';
                } else if (q) {
                  color = '#b2f2bb';
                }
                return `<div style='flex:1 1 0;min-width:0;min-height:10px;background:${color};${style}margin:0 1px;border-radius:2px;'></div>`;
              }).join("");
              let labels = months.map((m, i) => `<div style='flex:1 1 0;text-align:center;font-size:0.48em;color:#888;'>${m}</div>`).join("");
              barGraph = `<div style='max-width:95%;margin:0.5em auto 0.2em auto;'><div style='display:flex;gap:0.5px;'>${bars}</div><div style='display:flex;gap:0.5px;margin-top:2px;'>${labels}</div>`;
            }
          }
          let period = node.active ? `<div style='font-size:0.7em;color:#444;margin:0.5em 0 0.2em 0;'>Actief: ${node.active}</div>` : "";
          const rareClass = rareResults.includes(node.result) ? 'rare-result' : '';
          let descriptionBlock = node.description ? `<div style='width:100%;text-align:left;display:block;margin-top:0.7em;'><span style='font-size:1rem;font-weight:normal;color:#222;display:block;'>${node.description}</span></div>` : "";
          let infoBtn = node.infoUrl ? `<div style='margin-top:1em;margin-bottom:1em;text-align:center;'><button onclick="window.open('${node.infoUrl}','_blank')" style='font-size:1em;padding:0.9em 2.5em;border:none;border-radius:8px;background:#0074d9;color:#fff;font-weight:bold;cursor:pointer;display:inline-block;'>Meer informatie</button></div>` : "";
          const latinName = latinNames[node.result] || "";
          const latinNameDisplay = latinName ? `<div style='font-size:1em;color:#666;margin-bottom:1em;text-align:center;font-style:italic;'>(${latinName})</div>` : "";
          infoBlock.innerHTML = `<div style='background:#f7f7fa;border-radius:12px;padding:1em 1em 0.7em 1em;margin:1.2em 1em 1.2em 1em;box-shadow:0 1px 4px rgba(0,0,0,0.04);text-align:center;'>
            <div class='${rareClass}' style='font-size:1.4em;font-weight:bold;margin-bottom:0.2em;text-align:center;'>${node.result}</div>
            ${latinNameDisplay}
            <div style='text-align:center;'>${barGraph}</div>
            ${period}
            ${descriptionBlock}
            ${infoBtn}
          </div>`;
        } else {
          infoBlock.innerHTML = "";
        }
        qEl.innerHTML = "";
        qEl.className = "result" + (rareResults.includes(node.result) ? " rare-result" : "");
        imgEl.src = node.img;
        imgEl.alt = node.result;
      } else {
        qEl.textContent = ensureQuestionMark(node.q);
        qEl.className = "question";
        imgEl.src = node.img;
        imgEl.alt = node.q;
      }

      // Ja/Nee knoppen
      if (!node.result) {
        // Ja-knop
        const yesBtn = document.createElement("button");
        yesBtn.textContent = "Ja";
        if (node.yes) {
          yesBtn.className = "yes";
          yesBtn.onclick = () => {
            history.push(current);
            current = current.yes;
            showNode(current);
          };
        } else {
          yesBtn.className = "no-option-disabled";
          yesBtn.disabled = true;
          yesBtn.style.background = '#ccc';
          yesBtn.style.color = '#fff';
          yesBtn.style.cursor = 'not-allowed';
        }
        answerBtns.appendChild(yesBtn);

        // Nee-knop
        const noBtn = document.createElement("button");
        noBtn.textContent = "Nee";
        if (node.no && (node.no.q || node.no.result)) {
          noBtn.className = "no";
          noBtn.onclick = () => {
            history.push(current);
            current = current.no;
            showNode(current);
          };
        } else {
          noBtn.className = "no-option-disabled";
          noBtn.disabled = true;
          noBtn.style.background = '#ccc';
          noBtn.style.color = '#fff';
          noBtn.style.cursor = 'not-allowed';
        }
        answerBtns.appendChild(noBtn);
      }

      // Terug knop
      const backBtn = document.createElement("button");
      backBtn.className = "secondary";
      backBtn.textContent = "Terug";
      backBtn.onclick = () => {
        if (history.length > 0) {
          current = history.pop();
          showNode(current);
        } else {
          current = tree;
          history = [];
          showNode(current);
        }
      };
      navBtns.appendChild(backBtn);

      // Opnieuw knop
      const resetBtn = document.createElement("button");
      resetBtn.className = "secondary";
      resetBtn.textContent = "Opnieuw";
      resetBtn.onclick = () => {
        current = tree;
        history = [];
        showNode(current);
      };
      navBtns.appendChild(resetBtn);
    }

    // Start app in splash mode
    document.getElementById('main-app').style.display = 'none';
    document.getElementById('splash').style.display = 'flex';
  </script>
</body>
</html>
